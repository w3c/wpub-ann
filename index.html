<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
	<head>
		<meta charset="utf-8" />
		<title>Locators for Web Publications</title>
		<script src="https://www.w3.org/Tools/respec/respec-w3c-common" class="remove" defer="defer"></script>
		<script src="https://w3c.github.io/wpub/common/js/biblio.js" class="remove"></script>
		<link href="https://w3c.github.io/wpub/common/css/common.css" rel="stylesheet" type="text/css" />
		<link href="extras.css" rel="stylesheet" type="text/css" />
		<script class="remove">
			// <![CDATA[
          	var respecConfig = {
            	wg: "Publishing Working Group",
            	specStatus: "ED",
            	shortName: "publ-loc",
				noRecTrack: false,
            	//   edDraftURI: "https://w3c.github.io/wpub/",
              	editors: [
					{
                    	"name": "Timothy W. Cole",
                    	"url": "http://www.library.illinois.edu/people/bios/t-cole3/",
                    	"company": "University of Illinois at Urbana-Champaign",
                    	"companyURL": "http://illinois.edu",
						"w3cid": 53965,
                    	"extras": [{
                        	"name": "<img src='https://w3c.github.io/wpub/common/images/orcid_logo.png' alt='orcid logo'/>",
                        	"href": "https://orcid.org/0000-0002-5906-4581",
                        	"class": "orcid"
                      	}]
                  	},
                  	{
                    	"name": "Ivan Herman",
                    	"url": "https://www.w3.org/People/Ivan/",
                    	"company": "W3C",
						"w3cid": 7382,
                    	"extras": [{
                      		"name": "<img src='https://w3c.github.io/wpub/common/images/orcid_logo.png' alt='orcid logo'/>",
                      		"href": "http://orcid.org/0000-0003-0782-2704",
                      		"class": "orcid"
                    	}],
                    	"companyURL": "http://www.w3.org",
                  	}
              	],
				otherLinks: [{
					key: "Editors/Authors of the original version",
					data: [{
						value: "Ivan Herman, W3C",
						href: "https://www.w3.org/"
					}, {
						value: "Robert Sanderson, J Paul Getty Trust",
						href: "http://getty.edu/"
					}, {
						value: "Paulo Ciccarese, Massachusetts General Hospital",
						href: "http://www.paolociccarese.info"
					}, {
						value: "Benjamin Young, John Wiley & Sons, Inc.",
						href: "http://www.wiley.com/"
					}]
				}],
            	processVersion: 2017,
            	includePermalinks: true,
            	permalinkEdge:     true,
            	permalinkHide:     false,
            	diffTool:          "http://www.aptest.com/standards/htmldiff/htmldiff.pl",
            	wgURI:             "https://www.w3.org/publishing/groups/publ-wg/",
            	wgPublicList:      "public-publ-wg",
            	wgPatentURI:       "https://www.w3.org/2004/01/pp-impl/100074/status",
			  	github:			 {
					repoURL: "https://github.com/w3c/publ-loc",
				  	branch: "master"
			  	},
              	localBiblio: biblio
          	};
          	// ]]>
      	</script>
	</head>
	<body>
		<section id="abstract">
			<p>
				Selecting <em>part of</em> a resource on the Web is an ubiquitous action. Over the years several selection techniques have 
				been developed, usually in conjunction with the media type of the resource. 
				Many of these approaches are also expressed in terms of a <em>fragment identifiers</em>&nbsp;[[url]], 
				but that is not always the case.
			</p>
			
			<p>
				This document does not define any new approach to selection.
				Instead, it relies on existing techniques, providing a <em>common model and syntax</em> to express 
				and as needed combine or refine selections. 
				Additionally, this document extends the selection model described with methods for 
				expressing the information needed to retrieve a desired representation of a resource and/or identify 
				a precise location in the text stream or byte stream of a resource representation. 
				Although defined in conjunction with Web Publications, the techniques described in this document can be used for any type of Web Resources
			</p>

			<p>
				The formal specification and the semantics originate from a separate W3C Recommendation, 
				namely the Web Annotation Data Model&nbsp;[[annotation-model]], where it is used to select targets of annotations. 
				This model has been extended by adding more selector types and a new model component for describing positions in text and byte streams 
				(see the <a href="#introduction">Introduction</a> for further details).
			</p>
								
			<p class="issue" data-number=6></p>

		</section>

        <section id="sotd">
		</section>

		<section id="conformance">

			<section id="wa_extensions">
				<h3>Handling Undefined JSON Properties</h3>
				<p>
					This specification relies on a subset of JSON terms originally defined as part of the Web Annotation Data Model&nbsp;[[!annotation-model]] and Vocabulary&nbsp;[[!annotation-vocab]]. 
					This specification extends the definitions of some of those terms in order to satisfy additional use cases, but all uses conforming to original definitions remain valid.
					This specification also defines additional JSON terms to meet needs of additional use cases.
					In order to ensure backward compatibility, implementations of this specification MAY ignore any JSON terms not defined in this specification (directly or by reference to the Web Annotation Data Model and Vocabulary) and MUST NOT treat as invalid any JSON term encountered that is not defined in this specification.
				</p>
			</section>
			<section>
				<h3>Conformance requirements related to specific selectors</h3>
				<p>
					Not all Selectors defined in this specification are relevant for all Web Publication Resource media types.
					An implementation MAY therefore ignore certain types of Selectors in case the corresponding media types 
					are not handled by that particular implementation.
				</p>
			</section>

		</section>

        <section id="introduction" class=informative>
            <h2>Introduction</h2>

            <p>
            	Selecting a <em>part of</em> a resource on the Web is an ubiquitous action. Similarly, 
            	referencing a <em>position in</em> 
            	a resource representation is often necessary to support curation of and  discourse about Web resources. 
				Interactive editing of a resource, highlighting an area on the screen, adding an annotation to a specific point 
				in a resource, or defining a bookmark to a location or a section of a long document are all examples that 
				involve selection or positioning within a resource.</p>
        	<p>
				Over the years several techniques for selection have been developed, usually in conjunction with the media type of the resource.
				These include referring to a unique identifier within a resource, defining a time interval for an audio or video track, 
				identifying an element within the DOM tree for an XML source, or using CSS style elements to locate content.
				Many of these approaches are also expressed in terms of a <em>fragment identifiers</em>&nbsp;[[!url]], 
        but that is not always the case.
			</p>

            <p>
            	This document does not define any new approach to selection.
				Instead, it relies on existing techniques, providing a <em>common model and syntax</em> to express selections 
            	(i.e., using <em>selector</em> objects).
				Furthermore, the model also includes a way to <em>combine</em> and/or <em>refine</em> selections, 
            	a feature that may greatly improve the efficiency of applications relying on complex selections. This document
            	also models objects (<em>position</em> and <em>state</em>) supporting two additional curation and use tasks, 
            	thereby extending the selection model with ways to   
            	express the information needed to retrieve a desired representation of a resource and/or to identify 
            	a precise location in the text stream or byte stream of a resource representation.
				Such a common model makes it easier to provide generic and interoperable tools and APIs to handle selections in various 
				applications.
			</p>

            <p>
				A selection, position, or state <em>specifier</em>, as described in this document, may have its own unique identity 
				in the form of an URL.
				This URL SHOULD be dereferencable and return the selection/position/state specifier definition itself.
			</p>

            <p class="note">
				Using the URL of the selection definition, instead of the reference to the “complete” resource could be seen 
				as akin to a server side redirection, returning part of a resource.
            </p>

            <p>
				The data model is defined in [[json]], in the form of JSON objects and keys.
				The formal specification and the semantics of these originate from a larger model, namely the 
				Web Annotation Data Model&nbsp;[[!annotation-model]], where it is used to select targets of annotations.
				The current document “extracts” <a data-lt="Selector">Selectors</a> and <a data-lt="State">States</a> from that data model; by doing so, it makes their usage easier for applications developers whose concerns are not related to annotations. 
				Compared to the Web Annotation Data Model, however, this document <em>adds</em> two new selectors, namely:
			</p>

			<ul>
				<li><a href="#EmbeddedResourceSelector_def">Embedded Resource Selectors</a> can be used to select a full resource, with its a, from a collection of resources, also identified with a URL;</li>
				<li><a href="#MultipleSelector_def">Multiple Selectors</a> identify a collection of discrete selections, whether within the same or spread over several Sources.</li>
			</ul>

			<p>
				The document also <em>extends</em> the <a href="#RangeSelector_def">Range Selector</a> by:
			</p>

			<ul>
				<li>making explicit that the start and end selectors may refer to different resources;</li>
				<li>adding a property to define a list of “intermediate” resources for ranges that spread over several of those.</li>
			</ul>
        	
        	<p>
				These changes aim at addressing the particular requirements of resource collections on the Web, like Web Applications or Web Publications&nbsp;[[wpub]].
			</p>
        	
        	<p>
        		Additionally the current document augments the Web Annotation Data Model of selectors and states with a new class of specifier, <a data-lt="Position">Positions</a>. Two position specifiers are defined:
        	</p>
        	
     		<ul>
				<li><a href="#TextStreamPosition_def">Text Stream Position</a> can be used to define a position within a text stream representation of a resource.</li>
				<li><a href="#ByteStreamPosition_def">Byte Stream Position</a> can be used to define a position within a byte stream representation of a resource.</li>
			</ul>
        	
            <section class=normative id="terminology">
				<h3>Terminology</h3>

				<p><em>This section is normative</em></p>
				
				<p>
					Wherever appropriate, this document relies on terminology defined by the note on “Publishing and Linking on the Web”&nbsp;[[!publishing-linking]], including, in particular, <a class="externalDFN" href="https://www.w3.org/TR/publishing-linking/#dfn-user">user</a>, <a class="externalDFN" href="https://www.w3.org/TR/publishing-linking/#dfn-user-agent">user agent</a>, <a class="externalDFN" href="https://www.w3.org/TR/publishing-linking/#dfn-browser">browser</a>, and <a class="externalDFN" href="https://www.w3.org/TR/publishing-linking/#dfn-address">address</a>.
					Furthermore, the document also relies on some additional terms defined by the “Web Publication”&nbsp;[[wpub]], including a <a href="https://w3c.github.io/wpub/index.html#dfn-url" class="externalDFN">URL</a>.
				</p>
			
                <dl>
					<dt><dfn data-lt="Resource|Resources">Resource</dfn></dt>
					<dd>An item of interest that MAY be identified by a <a href="https://w3c.github.io/wpub/index.html#dfn-url">URL</a>.</dd>

					<dt><dfn data-lt="Web Resource|Web Resources">Web Resource</dfn></dt>
					<dd>A <a>Resource</a> that MUST be identified by a <a href="https://w3c.github.io/wpub/index.html#dfn-url">URL</a>, as described in the Web Architecture [[webarch]]. Web Resources MAY be dereferencable via their URL.</dd>

					<dt><dfn>Locator</dfn></dt>
                	<dd>A <a>Resource</a> that specifies a position in or a portion of another <a>Web Resource</a>. A Locator expresses its relationship to the relevant Web Resource (the <a>Source</a>) through a <code>source</code> term, and MAY express a contextual relationship to an additional <a>Web Resource</a> through a <code>scope</code> term.</dd>

					<dt><dfn data-lt="Sources">Source</dfn></dt>
                	<dd>The overall <a>Web Resource</a> whose selection is refined through the usage of <a data-lt="Selector">Selector</a>, <a data-lt="Position">Position</a>, or <a data-lt="State">State</a> specifier(s).</dd>

					<dt><dfn data-lt="segment">Segment (of Interest)</dfn></dt>
					<dd>The part of the <a>Web Resource</a> that is specified in a <a>Locator</a> using a <a>Selector</a> specifier.</dd>

          <dt><dfn data-lt="locus">Locus (of Interest)</dfn></dt>
          <dd>The location in the <a>Web Resource</a> that is specified in a <a>Locator</a> using a <a>Position</a> specifier.</dd>
                	
           <dt><dfn data-lt="External Web Resource|External Web Resources">External Web Resource</dfn></dt>                	
					<dd>A <a>Web Resource</a> which is not part of the representation the selection, such as a web page, image, or video. External Web Resources are dereferencable from their <a href="https://w3c.github.io/wpub/index.html#dfn-url">URL</a>.</dd>

					<dt><dfn data-lt="Property|Properties">Property</dfn></dt>
					<dd>A feature of a <a>Resource</a>, that often has a particular data type.  In the model sections, the term “Property” is used to refer to only those features which are <em>not</em> <a>Relationships</a> and instead have a literal value such as a string, integer, or date.  The valid values for a Property are thus any data type other than object, or an array containing members of that data type if more than one is allowed.</dd>

					<dt><dfn data-lt="Relationship|Relationships">Relationship</dfn></dt>
					<dd>In the model sections, the term “Relationship” is used to distinguish those features that refer to other <a>Resources</a>, either by reference to the <a>Resource</a>'s <a href="https://w3c.github.io/wpub/index.html#dfn-url">URL</a> or by including a description of the <a>Resource</a> in the representation. The valid values for a Relationship are: a quoted string containing a URL, an object that has the “id” property, or an array containing either of these if more than one is allowed.</dd>

					<dt><dfn data-lt="type|types|typing">Type</dfn></dt>
                	<dd>A feature of a <a>Resource</a> whose valid values are predefined strings (defined in this document) denoting the particular type of <a data-lt="Selector">Selector</a>, <a data-lt="Position">Position</a>, or <a data-lt="State">State</a> specifier.</dd>
                </dl>

				<p class=ednote>The reference to the TR version of the WPUB document must be used (for the url definition), when available.</p>

			</section>
        </section>

        <section id="locators" class="informative">
            <h3>Locators</h3>
            <p>
            	A <a>Resource</a> that specifies a location in or a portion of another <a>Web Resource</a>. 
				It does this using <dfn data-lt="Specifiers|Specifier">Specifiers</dfn> that can be any of:
			</p>

            <ul>
              	<li><a>Selector</a>: Describes the desired segment of interest in the source</li>
              	<li><a>State</a>: Describes the desired representation of the source</li>
            	  <li><a>Position</a>: Describes the desired locus of interest in the source</li>
            </ul>

            <p>
				Specifiers MAY be External Web Resources with their own URLs, such as in the example for the <a href="#selectors">Selector</a> construction, however it is RECOMMENDED that they be included in the representation to avoid requiring unnecessary network interactions to retrieve all of the information.
			</p>
			
            <h4>Model</h4>

            <table class="model">
                <tr><th>Term</th><th>Type</th><th>Description</th></tr>
                <tr>
                    <td>id</td>
                    <td>Property</td>
                    <td>The identity of the Locator<br/> A Locator SHOULD have exactly 1 URL that identifies it.</td>
                </tr>
                <tr>
                    <td>source</td>
                    <td>Relationship</td>
                    <td>The relationship between a Locator and the resource that it is a more specific representation of, i.e., the <a>Source</a>.
                    <br/>There MUST be exactly 1 <code>source</code> relationship associated with a Locator.  The source resource MAY be described in detail as in the core data model or be just the resource’s URL.</td>
				</tr>
                <tr>
                    <td>scope</td>
                    <td>Relationship</td>
                    <td>The relationship between a Locator and the resource that provides the scope or context in this selection.<br/>
						There MAY be 0 or more scope relationships for each Locator. Conceptually, if no scope is provided, the value of the <code>source</code> relationship can be considered as the scope.
				</tr>
			</table>

			<p class=issue data-number=12></p>
			<p class=issue data-number=22>Example on switching scope and source: is it it o.k.?</p>

        </section>

        <section id="selectors" class="informative">
            <h3>Selectors</h3>

            <p>Selection of part of a <a>Web Resource</a> requires two distinct entities:</p>

            <ol>
                <li>
                	the <a href=" https://w3c.github.io/wpub/index.html#dfn-url">URL</a> of the overall resource; we will refer to this as the <a>Source</a>.
				</li>
                <li>
					the identification for the part of that resource; we will refer to this as the <a data-lt="segment">Segment (of Interest)</a>.
				</li>
            </ol>

            <p>
				A <dfn data-lt="Selectors">Selector</dfn> object is used to describe how to determine the <a>Segment</a> from within the <a>Source</a> resource.
				The nature of the Selector is dependent on the type of resource, as the methods to describe Segments from various media-types differ. These two entities are encapsulated in a <a>Locator</a>.
			</p>

            <p>
				<b>Example Use Case:</b> Qitara wants to associate a selection of text in a web page with a slice of a dataset.
				She selects both using her client, and creates Locators with Selectors for both entities before associating them with one another.
			</p>

            <h4>Model</h4>

            <table class="model">
                <tr><th>Term</th><th>Type</th><th>Description</th></tr>
                <tr>
                    <td>selector</td>
                    <td>Relationship</td>
                    <td>The relationship between a Locator and a Selector.
						<br/>There MAY be 0 or more <code>selector</code> relationships associated with a Locator. 
						Multiple Selectors SHOULD select the same content, however some Selectors will not have the same precision as others.
						User Agents MUST pick one of the described <a data-lt="segment">segments</a>, if they are different.
                    </td>
                </tr>
			</table>
            <h4>Example</h4>

            <pre class="example highlight" title="Selectors">
			{
			  "source": "http://example.org/page1",
			  "selector": "http://example.org/paraselector1"
			}
            </pre>

            <section id="FragmentSelector_def">
                <h3>Fragment Selector</h3>

                <p>
					As the most well understood mechanism for selecting a <a>Segment</a> is to use the fragment part of a URL defined by the representation’s media type, it is useful to allow this as a description mechanism via a Selector.
					This allows existing and future fragment specifications to be used with Locators in a consistent way.
					To be clear about which fragment type is being used, the <a>Selector</a> may refer to the specification that defines it.
				</p>

                <p>
					<b>Example Use Case:</b> Ramona wants to associate part of a video as the description of an image.
					She selects the time range within the video and clicks that it is describing the target.
					Her client then creates the Annotation using a Locator with a FragmentSelector.
				</p>

                <h4>Model</h4>

                <table class="model">
                    <tr><th>Term</th><th>Type</th><th>Description</th></tr>
                    <tr>
                        <td>type</td>
                        <td>Relationship</td>
						<td>The class of the Selector.<br/>
							FragmentSelectors MUST have exactly 1 <code>type</code> and the value MUST be <code>FragmentSelector</code>.</td>
                    </tr>
                    <tr>
                        <td>value</td>
                        <td>Property</td>
                        <td>The contents of the fragment component of a URL that describes the Segment.<br/>
                            The FragmentSelector MUST have exactly 1 <code>value</code> property.</td>
                    </tr>
                    <tr>
                        <td>conformsTo</td>
                        <td>Relationship</td>
                        <td>The relationship between the FragmentSelector and the specification that defines the syntax of the URL fragment in the <code>value</code> property.
                        <br/>The Fragment Selector SHOULD have exactly 1 <code>conformsTo</code> link to the specification that defines the syntax of the fragment and MUST NOT have more than 1.</td>
                    </tr>
                </table>

                <p>
					It is RECOMMENDED to use <code>FragmentSelector</code> as a consistent method compatible with other means of describing Locators, rather than using the URL with a fragment directly. 
					User Agents SHOULD be aware of both.
				</p>

                <p>
					The following URLs are some of the specifications that define the semantics of fragments, and hence may be used with the <code>conformsTo</code> relationship.  
					Other URLs MAY also be used.
				</p>

                <table class="model">
                    <tr><th>Name</th><th>Fragment Specification</th><th>Description</th></tr>
                    <tr><td>HTML</td><td>http://tools.ietf.org/rfc/rfc3236</td><td>[[rfc3236]] Example: <code>namedSection</code> </td></tr>
                    <tr><td>PDF</td><td>http://tools.ietf.org/rfc/rfc3778</td><td>[[rfc3778]] Example: <code>page=10&amp;viewrect=50,50,640,480</code></td></tr>
                    <tr><td>Plain Text</td><td>http://tools.ietf.org/rfc/rfc5147</td><td>[[rfc5147]] Example: <code>char=0,10</code></td></tr>
                    <tr><td>XML</td><td>http://tools.ietf.org/rfc/rfc3023</td><td>[[rfc3023]] Example: <code>xpointer(/a/b/c)</code></td></tr>
                    <tr><td>CSV</td><td>http://tools.ietf.org/rfc/rfc7111</td><td>[[rfc7111]] Example: <code>row=5-7</code></td></tr>
                    <tr><td>Media</td><td>http://www.w3.org/TR/media-frags/</td><td>[[media-frags]] Example: <code>xywh=50,50,640,480</code></td></tr>
                    <tr><td>SVG</td><td>http://www.w3.org/TR/SVG/</td><td>[[svg11]] Example: <code>svgView(viewBox(50,50,640,480))</code></td></tr>
                </table>

                <div class="note">
					The URL that uses the fragment may be reconstructed by concatenating the <code>source</code>, a <code>#</code>, and the <code>value</code>. 
					For example, the URL from the example below would be <code>http://example.org/video1#t=30,60</code>.
                </div>

                <h4>Example</h4>

                <pre class="example highlight" title="Fragment Selector" id="FragmentSelector_ex">
{
  "source": "http://example.org/video1",
  "selector": {
    "type": "FragmentSelector",
    "conformsTo": "http://www.w3.org/TR/media-frags/",
    "value": "t=30,60"
  }
}
                </pre>
            </section>

            <section id="CssSelector_def">
                <h3>CSS Selector</h3>

                <p>
					One of the most common ways to select elements in the HTML Document Object Model is to use CSS Selectors&nbsp;[[css3-selectors]]. 
					CSS Selectors allow for a wide variety of well supported ways to describe the path to an element in a web page, and thus cover many of the basic use cases for selection. 
					Results are not defined for when a CSS Selector is applied to a representation that does not conform to the Document Object Model.
				</p>

                <p>
					<b>Example Use Case:</b> Sally selects a paragraph in a one of the chapters of a Web Publication that she wishes bookmark.  
					Her client calculates a CSS path that cleanly identifies that element and stores CSS Selector in its local bookmark store.
					Because the selection is made as part of a Web Publication (e.g., through the WP aware User Agent), a reference to the Web Publication’s address is also added to the bookmark.
				</p>

                <h4>Model</h4>

                <table class="model">
                    <tr><th>Term</th><th>Type</th><th>Description</th></tr>
                    <tr>
                        <td>type</td>
                        <td>Relationship</td>
                        <td>The class of the Selector.<br/>CssSelectors MUST have exactly 1 <code>type</code> and the value MUST be <code>CssSelector</code>.</td>
                    </tr>
                    <tr>
                        <td>value</td>
                        <td>Property</td>
                        <td>The CSS selection path to the Segment.
                        <br/>There MUST be exactly 1 <code>value</code> associated with a CSS Selector.</td>
                    </tr>
                </table>

                <div class="note">
                	Implementers SHOULD use only commonly supported features of CSS that directly contribute to selection of an element or content, rather than styling or transformation, in order to maximize interoperability between systems.
                </div>

                <h4 id="scope_example">Example</h4>

                <pre class="example highlight" title="CSS Selector" id="CssSelector_ex">
{
  "scope": "https://dauwhe.github.io/html-first/MobyDick.wpub",
  "source": "https://dauwhe.github.io/html-first/MobyDickNav/html/c001.html",
  "selector": {
    "type": "CssSelector",
    "value": "#elemid > .elemclass + p"
  }
}
                </pre>
            </section>

            <section id="XPathSelector_def">
                <h3>XPath Selector</h3>

                <p>
					Another common method of selecting elements and content within a resource that supports the Document Object Model (DOM), such as documents in XML or HTML, is to use an XPath selection [[dom-level-3-xpath]].
					XPath allows a great deal of flexibility when describing the path through the structure to the selected content.
					Results are not defined for when an XPath Selector is applied to a representation that does not conform to the DOM.
				</p>

                <div class="note">
					Implementers should note that the <a href="https://www.w3.org/TR/html5/syntax.html#optional-tags">HTML5 specification</a> allows parsers to add elements into the DOM that are considered to be missing.
					XPaths SHOULD be constructed to include these elements, rather than from the element structure in the document.
                </div>

                <p>
					<b>Example Use Case:</b> Teynika selects a span within a table in an HTML page and writes a note about the content.
					To refer explicitly to this element, her client carefully constructs an XPath to identify the relevant element.
				</p>

                <h4>Model</h4>

                <table class="model">
                    <tr><th>Term</th><th>Type</th><th>Description</th></tr>
                    <tr>
                        <td>type</td>
                        <td>Relationship</td>
                        <td>The class of the Selector.<br/>XPath Selectors MUST have exactly 1 <code>type</code> and the value MUST be <code>XPathSelector</code>.</td>
                    </tr>
                  </tr>
                  <tr>
                      <td>value</td>
                      <td>Property</td>
                      <td>The xpath to the selected segment.
                       <br/>There MUST be exactly 1 <code>value</code> associated with an XPath Selector.</td></tr>
                </table>

                <div class="note">
                	Implementers SHOULD use only commonly supported features of XPath that directly contribute to selection of an element or content in order to maximize interoperability between systems.
                </div>

                <h4>Example</h4>

                <pre class="example highlight" title="XPath Selector" id="XPathSelector_ex">
{
  "source": "http://example.org/page1.html",
  "selector": {
    "type": "XPathSelector",
    "value": "/html/body/p[2]/table/tr[2]/td[3]/span"
  }
}
                </pre>
            </section>

            <section id="TextQuoteSelector_def">
                <h3>Text Quote Selector</h3>

                <p>
					This <a>Selector</a> describes a range of text by copying it, and including some of the text immediately before (a prefix) and after (a suffix) it to distinguish between multiple copies of the same sequence of characters.
                </p>

                <p>
                	For example, if the document was “abcdefghijklmnopqrstuvwxyz”, one could select “efg” by a prefix of “abcd”, the match of “efg” and a suffix of “hijk”.
                </p>

                <p>
					<b>Example Use Case:</b> Ulrika selects a typo (‘anotation’) in a web page and adds a comment that it should be replaced with the correct spelling (‘annotation’).
				</p>

                <h4>Model</h4>

                <table class="model">
                    <tr><th>Term</th><th>Type</th><th>Description</th></tr>
                    <tr>
                        <td>type</td>
                        <td>Relationship</td>
                        <td>The class of the Selector.<br/>Text Quote Selectors MUST have exactly 1 <code>type</code> and the value MUST be <code>TextQuoteSelector</code>.</td>
                    </tr>
                    <tr>
                        <td>exact</td>
                        <td>Property</td>
                        <td>A copy of the text which is being selected, after normalization.
                        <br/>Each TextQuoteSelector MUST have exactly 1 <code>exact</code> property. </td>
                    </tr>
                    <tr>
                        <td>prefix</td>
                        <td>Property</td>
                        <td>A snippet of text that occurs immediately before the text which is being selected.
                        <br/>Each TextQuoteSelector SHOULD have exactly 1 <code>prefix</code> property, and MUST NOT have more than 1.</td>
                    </tr>
                    <tr>
                        <td>suffix</td>
                        <td>Property</td>
                        <td>The snippet of text that occurs immediately after the text which is being selected.
                        <br/>Each TextQuoteSelector SHOULD have exactly 1 <code>suffix</code> property, and MUST NOT have more than 1.</td>
                    </tr>
                </table>

                <p>
					The selection of the text MUST be in terms of unicode code points (the “character number”), not in terms of code units (that number expressed using a selected data type). 
					Selections SHOULD NOT start or end in the middle of a grapheme cluster.
					The selection MUST be based on the <a href="https://www.w3.org/International/questions/qa-visual-vs-logical">logical order</a> of the text, rather than the visual order, especially for bidirectional text.
					For more information about the character model of text used on the web, see&nbsp;[[charmod]].
					Also, The text MUST be normalized for the purpose of selection.
					Thus HTML/XML tags SHOULD be removed, and character entities SHOULD be replaced with the character that they encode.
				</p>
				
                <p>
					If, after processing the prefix, exact, and suffix, the user agent discovers multiple matching text sequences, then the selection SHOULD be treated as matching all of the matches.
				</p>

                <div class="note">
					If the content is under copyright or has other rights asserted on its use, then this method of selecting text is potentially dangerous. 
					For example, a user might select the entire text of the document to annotate, which would not be desirable to copy into the Annotation and share. 
					For static texts with access and/or distribution restrictions, the use of the Text Position Selector is perhaps more appropriate.
                </div>

                <h4>Example</h4>

                <pre class="example highlight" title="Text Quote Selector" id="TextQuoteSelector_ex">
{
  "source": "http://example.org/page1",
  "selector": {
    "type": "TextQuoteSelector",
    "exact": "anotation",
    "prefix": "this is an ",
    "suffix": " that has some"
  }
}
                </pre>
            </section>

            <section id="TextPositionSelector_def">
            	<h3>Text Position Selector</h3>

            	<p>
					This <a>Selector</a> describes a range of text by recording the start and end positions of the selection in the stream. 
					Position 0 would be immediately before the first character, position 1 would be immediately before the second character, and so on. 
					The start character is thus included in the list, but the end character is not.
				</p>

           		<p>
            		For example, if the document was “abcdefghijklmnopqrstuvwxyz”, the start was 4, and the end was 7, then the selection would be “efg”.
            	</p>

            	<p>
					<b>Example Use Case:</b> Valeria writes a review of an ebook that does not allow its content to be extracted and copied.  Her client describes the selection using its start and end position in the content.
				</p>

            	<h4>Model</h4>

				<table class="model">
					<tr><th>Term</th><th>Type</th><th>Description</th></tr>
					<tr>
						<td>type</td>
						<td>Relationship</td>
						<td>The class of the Selector.<br/>Text Position Selectors MUST have exactly 1 <code>type</code> and the value MUST be <code>TextPositionSelector</code>.</td>
					</tr>
					<tr>
						<td>start</td>
						<td>Property</td>
						<td>The starting position of the segment of text. The first character in the full text is character position 0, and the character is included within the segment.
						<br/>Each TextPositionSelector MUST have exactly 1 <code>start</code> property, and the value MUST be a non-negative integer.</td>
					</tr>
					<tr>
						<td>end</td>
						<td>Property</td>
						<td>The end position of the segment of text. The character is not included within the segment.
						<br/>Each TextPositionSelector MUST have exactly 1 <code>end</code> property, and the value MUST be a non-negative integer.</td>
					</tr>
				</table>

            	<p>
					The text MUST be selected and normalized in the same way as for the <a href="#TextQuoteSelector_def">Text Quote Selector</a> before counting the number of characters to determine the start and end positions.
				</p>

            	<div class="note">
					   The use of this <a>Selector</a> does not require text to be copied from the <a>Source</a> when storing, e.g., a bookmarks, unlike the Text Quote Selector, but is very brittle with regards to changes to the resource.
					   Any edits or dynamically transcluded content may change the selection, and thus it is RECOMMENDED that a <a>State</a> be additionally used to help identify the correct representation.
           		</div>

            	<h4>Example</h4>

				<pre class="example highlight" title="Text Position Selector" id="TextPositionSelector_ex">
{
  "source": "http://example.org/ebook1",
  "selector": {
    "type": "TextPositionSelector",
    "start": 412,
    "end": 795
  }
}
	            </pre>
        	</section>

       		<section id="DataPositionSelector_def">
            	<h3>Data Position Selector</h3>

            	<p>Similar to the <a href="#TextPositionSelector_def">Text Position Selector</a>, the Data Position Selector uses the same properties but works at the byte in bitstream level rather than the character in text level.</p>

				<p><b>Example Use Case:</b> Wendy produces visualizations of regions of online disk images for as part of her publication.
					She calculates the start and end positions from the binary stream and stores that as a reference using the DataPositionSelector.
				</p>


            	<h4>Model</h4>

				<table class="model">
					<tr><th>Term</th><th>Type</th><th>Description</th></tr>
					<tr>
						<td>type</td>
						<td>Relationship</td>
						<td>The class of the Selector.<br/>Data Position Selectors MUST have exactly 1 <code>type</code> and the value MUST be <code>DataPositionSelector</code>.</td>
					</tr>
					<tr>
						<td>start</td>
						<td>Property</td>
						<td>The starting position of the segment of data. The first byte is character position 0. <br/>Each DataPositionSelector MUST have exactly 1 <code>start</code> property.</td>
					</tr>
					<tr>
						<td>end</td>
						<td>Property</td>
						<td>The end position of the segment of data. The last character is not included within the segment.<br/>Each DataPositionSelector MUST have exactly 1 <code>end</code> property.</td>
					</tr>
				</table>

				<h4>Example</h4>

				<pre class="example highlight" title="Data Position Selector" id="DataPositionSelector_ex">
{
  "source": "http://example.org/diskimg1",
  "selector": {
    "type": "DataPositionSelector",
    "start": 4096,
    "end": 4104
  }
}
				</pre>
        	</section>

			<section id="SvgSelector_def">
				<h3>SVG Selector</h3>

				<p>
					An SvgSelector defines an area through the use of the Scalable Vector Graphics&nbsp;[[svg11]] standard. 
					This allows the user to select a non-rectangular area of the content, such as a circle or polygon by describing the region using SVG.
					The SVG may be either embedded or referenced as an <a>External Web Resource</a>.
				</p>

				<p>
					Note that the SvgSelector uses SVG to select an area of a resource.
					Segments of an SVG representation may also be selected using selectors, including the FragmentSelector or even an SvgSelector.
				</p>

				<p>
					<b>Example Use Case:</b> Xena is tagging an old map online with a diagonal region for a historical road.  Her client creates SVG polygon to highlight the region by overlaying a transparent area with a different color.
				</p>

				<h4>Model</h4>

				<table class="model">
					<tr><th>Term</th><th>Type</th><th>Description</th></tr>
					<tr>
						<td>type</td>
						<td>Relationship</td>
						<td>The class of the Selector.<br/>SVG Selectors MUST have exactly 1 <code>type</code> and the value MUST include <code>SvgSelector</code>.
					</tr>
					<tr>
						<td>value</td>
						<td>Property</td>
						<td>The character sequence of the SVG content.<br/> There MAY be exactly 1 <code>value</code> property associated with the Selector, and if so the value of the property MUST be well-formed SVG XML.</td>
					</tr>
				</table>

				<p>
					The dimensions of the SVG shape or canvas MUST be relative to the dimensions of the <a>Source</a>, such that scaling the shape’s size to the full size of the image correctly describes the desired area.
				</p>

				<div class="note">
					Implementers SHOULD use only commonly supported features of SVG that directly contribute to describing a region, rather than styling or transformation, in order to maximize interoperability between systems.
					It is NOT RECOMMENDED to include style information within the SVG element, nor Javascript, animation, text or other non-shape oriented information.
					Clients SHOULD ignore such information if present.
				</div>

				<h4>Example</h4>

				<pre class="example highlight" title="SVG Selector" id="SvgSelector_ex_1">
{
  "source": "http://example.org/map1",
  "selector": {
    "type": "SvgSelector",
    "id": "http://example.org/svg1"
  }
}
				</pre>

				<pre class="example highlight" title="SVG Selector, embedded" id="SvgSelector_ex_2">
{
  "source": "http://example.org/map1",
  "selector": {
    "type": "SvgSelector",
    "value": "&lt;svg:svg&gt; ... &lt;/svg:svg&gt;"
  }
}
				</pre>
			</section>

			<section id="EmbeddedResourceSelector_def" class="normative">
				<h3>Embedded Resource Selector</h3>

				<p><em>This section is normative</em></p>

				<p>
					For some use cases it is required to identify a resource that part of a group of resources, where that group has its own identity on the Web (and can be identified via its own URL). 
					An example may be resource representing a chapter as part of a Web Publication&nbsp;[[!wpub]]).
					An Embedded Resource Selector can be used to identify that resource through the <code>value</code> relationship.
					This Selector is usually used in conjunction with other Selectors, e.g., through a <a href="#SelectorRefinement_def">refinement</a>.
				</p>
				
				<p>
					<b>Example Use Case:</b> Janine wants to select the cover image of a Web Publication, which is linked to the Web Publication as a whole.
					She uses an Embedded Resource Selector to designate the image, with the Web Publication’s address as the <a>Source</a> for the selector. 
				</p>
	
				<h4>Model</h4>

				<table class="model">
					<tr><th>Term</th><th>Type</th><th>Description</th></tr>
					<tr>
						<td>type</td>
						<td>Relationship</td>
						<td>The class of the Selector.<br/>Range Selectors MUST have exactly 1 <code>type</code> and the value MUST be <code>EmbeddedResourceSelector</code>.</td>
					</tr>
					<tr>
					<tr>
						<td>value</td>
						<td>Relationship</td>
						<td>The URL of the resource within the collection or resources identified by the <a>Source</a>.<br/>An EmbeddedResourceSelector MUST have exactly 1 <code>value</code> property.</td>
					</tr>
				</table>

				<p class=issue data-number=24></p>

				<h4>Example</h4>
				<pre class="example highlight" title="Embedded Resource Selector" id="EmbeddedResourceSelector_ex">
{
  "source": "https://dauwhe.github.io/html-first/MobyDick.wpub",
  "selector": {
    "type": "EmbeddedResourceSelector",
    "value": "https://dauwhe.github.io/html-first/MobyDickNav/images/moby-dick-book-cover.jpg"
  }
}				</pre>
			</section>

			<section id="SelectorRefinement_def">
					<h3>Refinement of Selection</h3>
	
					<p>
						It may be easier, more reliable, or more accurate to specify the segment of interest of a resource as a selection of a selection, rather than as a selection of the complete resource.
						Particularly for resources that contain other resources, such as various packaging formats, this also allows decomposition of the selection mechanisms when the components do not have unique identifiers. 
						This is accomplished by having selectors chained together, where each refines the results of the previous one.
					</p>
	
					<p>
						<b>Example Use Case:</b> Zara selects a paragraph of text and then a short phrase within it.
						Her client records the phrase as a TextQuoteSelector that further modifies a FragmentSelector used to identify the paragraph that the phrase is part of.
					</p>

					<div class=note>
						<p>
							A frequent usage of refinement is in combination with an <a href="#EmbeddedResourceSelector_def">Embedded Resource Selector</a> to denote the fact that a particular selection is related to, e.g., a Web Publication.
							For example:
						</p> 

						<pre class="example highlight">
{
  "source": "https://dauwhe.github.io/html-first/MobyDick.wpub",
  "selector": {
    "type": "EmbeddedResourceSelector",
    "value": "https://dauwhe.github.io/html-first/MobyDickNav/html/c001.html",
    "refinedBy": {
      "type": "CssSelector",
      "value": "#elemid > .elemclass + p"
    }		
  }
}
						</pre>

						<p>
							For such a simple case, the usage of <code>scope</code> provides for a more succinct way of expressing the same information, see <a href="#scope_example">the example for a CSS Selector</a>. However, when combined with other selectors like, for example, a <a href="#RangeSelector_def">Range Selector</a>, the usage of this pattern becomes essential.
						</p>
					</div>
					
					<h4>Model</h4>
	
					<table class="model">
					<tr><th>Term</th><th>Type</th><th>Description</th></tr>
						<tr>
							<td>refinedBy</td>
							<td>Relationship</td>
							<td>The relationship between a broader selector and the more specific selector or position that should be applied to the results of the first. <br/>A Selector MAY be <code>refinedBy</code> 1 or more other <a>Selectors</a> or <a>Positions</a>.  If more than 1 is given, then they are considered to be alternatives that will result in the same selection.</td>
						</tr>
					</table>
	
					<h4>Examples</h4>
	
					<pre class="example highlight" title="Selector Refinement" id="SelectorRefinement_ex">
{
  "source": "http://example.org/page1",
  "selector": {
    "type": "FragmentSelector",
    "value": "para5",
    "refinedBy": {
      "type": "TextQuoteSelector",
      "exact": "Selected Text",
      "prefix": "text before the ",
      "suffix": " and text after it"
    }
  }
}
				</pre>
			</section>

			<section id="RangeSelector_def" class="normative">
				<h3>Range Selector</h3>

				<p><em>This section is normative</em></p>
				
				<p>
					Selections made by users may be extensive and/or cross over internal boundaries in the representation, making it difficult to construct a single selector that robustly describes the correct content. 
					A Range Selector can be used to identify the beginning and the end of the selection by using other Selectors.
					In this way, two points can be accurately identified using the most appropriate selection mechanisms, and then linked together to form the selection.
					For some use cases it is also required to identify a range that spans, possibly, over multiple contiguous members of a group of resources (e.g., a subset in order of the resources which comprise a Web Publication&nbsp;[[!wpub]]).
					A Range Selection MAY therefore spread over several <a>Sources</a>, e.g., through the usage of <a href="#EmbeddedResourceSelector_def">Embedded Resource Selectors</a>. 
					The selection consists of:
				</p>
				
				<ul>
					<li>if both the start and the end selectors refer to the same <a>Source</a>, then everything from the beginning of the starting selector through to the beginning of the ending selector, but not including it;</li>
					<li>otherwise, everything from the beginning of the starting selector until the end of its <a>Source</a>, all the <a>Sources</a> defined as values of the <code>selectors</code> property (if any), and finally everything from the beginning of the <a>Source</a> of the ending selector to the beginning of the ending selector, but not including it.</li>
				</ul>
				
				<p>
					<b>Example Use Case:</b> Yadira wants to comment on text in a Web Publication that spreads over several paragraphs.
					She selects the start and the end of the selection; her User Agent calculates the Range Selector using the first selection as a start and the second selector as the end.
				</p>

				<p>
					<b>Example Use Case:</b> Misha wants to comment on text in a Web Publication that spreads over <em>several constituent resources</em>.
					He selects the start and the end of the selection in different of those resources; his User Agent calculates the Range Selector using a series of Embedded Resource Selections from the first selection as a start and the second selector as the end to provide a continuous range.
				</p>

				<h4>Model</h4>

				<table class="model">
					<tr><th>Term</th><th>Type</th><th>Description</th></tr>
					<tr>
						<td>type</td>
						<td>Relationship</td>
						<td>The class of the Selector.<br/>Range Selectors MUST have exactly 1 <code>type</code> and the value MUST be <code>RangeSelector</code>.</td>
					</tr>
					<tr>
						<td>startSelector</td>
						<td>Relationship</td>
						<td>The Selector which describes the inclusive starting point of the range. <br/>There MUST be exactly 1 <code>startSelector</code> associated with a Range Selector.</td>
					</tr>
					<tr>
						<td>selectors</td>
						<td>Relationship</td>
						<td>Provides a, possibly empty, list of <a href="#EmbeddedResourceSelector_def">Embedded Resource Selectors</a>, which define intermediate <a>Sources</a> for the full selection.	
						<br/>There MAY at most 1 <code>selectors</code> associated with a Range Selector.</td>
					</tr>					
					<tr>
						<td>endSelector</td>
						<td>Relationship</td>
						<td>The Selector which describes the exclusive ending point of the range. <br/>There MUST be exactly 1 <code>endSelector</code> associated with a Range Selector.  Both <code>startSelector</code> and <code>endSelector</code> SHOULD be of the same class.</td>
					</tr>
				</table>

				<p class=issue data-number=25></p>

				<h4>Example</h4>

				<pre class="example highlight" title="Range Selector" id="RangeSelector_ex">
{
  "source": "https://dauwhe.github.io/html-first/MobyDickNav/html/c001.html",
  "scope": "https://dauwhe.github.io/html-first/MobyDick.wpub",
  "selector": {
    "type": "RangeSelector",
    "startSelector": {
      "type": "TextQuoteSelector",
      "exact": "Call me Ishmael.",
      "suffix": "Some years ago"
    },
    "endSelector": {
      "type": "TextQuoteSelector",
      "exact": "He desires to paint you the dreamiest, ",
      "prefix": "But here is an artist. ",
      "suffix": "shadiest, quietest"
    }
  }
}
				</pre>

				<pre class="example highlight" title="Range Selector Over Several Resources" id="RangeSelector_ex_1">
{
  "source": "https://dauwhe.github.io/html-first/MobyDick.wpub",
  "selector": {
    "type": "RangeSelector",
    "startSelector": {
      "type": "EmbeddedResourceSelector",
      "value": "https://dauwhe.github.io/html-first/MobyDickNav/html/c001.html",
      "refinedBy" : {
        "type": "TextQuoteSelector",
        "exact": "Call me Ishmael.",
        "suffix": "Some years ago"	
      }
    },
    "selectors": [{
      "type": "EmbeddedResourceSelector",
      "value": "https://dauwhe.github.io/html-first/MobyDickNav/html/c002.html",
    },{
      "type": "EmbeddedResourceSelector",
      "value": "https://dauwhe.github.io/html-first/MobyDickNav/html/c003.html",			
    }],
    "endSelector": {
      "type": "EmbeddedResourceSelector",
      "value": "https://dauwhe.github.io/html-first/MobyDickNav/html/c004.html",
      "refinedBy": {
        "type": "TextQuoteSelector",
        "exact": "He commenced dressing",
        "suffix": " at top"	
      }
    }
  }
}
				</pre>
			</section>

			<section id="MultiSelector_def" class="normative">
				<h3>Multi Selector</h3>

				<p><em>This section is normative</em></p>

				<p>
					For some use cases it is required to identify a fragment that spans, possibly, over multiple members of a group of resources (e.g., a subset in order of the resources which comprise a Web Publication&nbsp;[[!wpub]]). 
					A Multi Selection can be used to identify this group by creating an ordered list of Selectors.
					A Multi Selection identifies a collection of discrete selections, whether within the same or spread over several <a>Sources</a>.
					These selectors MAY be refinements of <a href="#EmbeddedResourceSelector_def">Embedded Resource Selectors</a>, if the group spawns over several <a>Sources</a>.
				</p>
					
				<p>
					<b>Example Use Case:</b> Example Use Case: Rachel is writing a summative assessment question with hints pointing back to the textbook. The questions pulls on material presented in Chapter 2, a-head 3, Chapter 4, a-head 6, and in Chapter 7, a-head 8. She uses the Multi Resource Selector defining a single link to add to the hints section of her assessment questions that references Sections 2.3, Section 4.6, and Section 7.8, but nothing in between them. 					
				</p>
	
				<h4>Model</h4>

				<table class="model">
					<tr><th>Term</th><th>Type</th><th>Description</th></tr>
					<tr>
						<td>type</td>
						<td>Relationship</td>
						<td>The class of the Selector.<br/>Range Selectors MUST have exactly 1 <code>type</code> and the value MUST be <code>MultiResourceSelector</code>.</td>
					</tr>
					<tr>
						<td>selectors</td>
						<td>Relationship</td>
						<td>A list of Selectors. <br/>There MUST be exactly 1 <code>selectors</code> associated with a Multi  Selector.
							<br/>The list MUST have at least 1 element. 
						</td>
					</tr>
				</table>

				<p class=issue data-number=26></p>

				<h4>Example</h4>

				<pre class="example highlight" title="Multi Selector" id="MultiSelector_ex">
{
  "source": "https://textbook.example.org/",
  "selector": {
    "type": "MultiSelector",
    "selectors": [{
      "type" : "EmbeddedResourceSelector",
      "value": "https://textbook.example.org/section2.html",
      "refinedBy": {
        "type": "CssSelector",
        "value": "body>section:nth-of-type(3)"
      }
    },{
      "type": "EmbeddedResourceSelector",
      "value": "https://textbook.example.org/section4.html",
      "refinedBy": {
        "type": "CssSelector",
        "value": "body>section:nth-of-type(6)"
      }
    },{
      "type": "EmbeddedResourceSelector",
      "value": "https://textbook.example.org/section7.html",
      "refinedBy": {
        "type": "CssSelector",
        "value": "body>section:nth-of-type(8)"
      }
    }]
  }    
}
				</pre>
			</section>			
		</section> <!-- /Selectors -->

		<section id="states">
			<h3>States</h3>
			
			<p>
				A State describes the intended state of a resource when selected, and thus provides the information needed to retrieve the correct representation of that resource.
				Web resources change over time, and a State might be used to describe how to recover the intended previous version. 
				Web resources also have multiple formats, and a State might equally be used to describe how to retrieve that particular format.
			</p>
			
			<p>The state aspect of a <a>Web Resource</a> requires two distinct entities:</p>
			
			<ol>
				<li>
					the <a href=" https://w3c.github.io/wpub/index.html#dfn-url">URL</a> of the overall resource; this is the same <a>Source</a> as used for Selectors (see <a href="#selectors"></a>). 
				</li>
				<li>the identification for the state of the resource.</li>
			</ol>
			
			<p>
				A <dfn>State</dfn> object is used to describe how to determine the state of interest from within the <a>Source</a> resource. These two entities are encapsulated in a <a>Locator</a>.</p>
				</p>
			
			<p>
				<b>Example Use Case:</b> Alexandra visualizes data on a web page that changes frequently. Her client records information to allow other clients to hopefully reconstruct the original visualization.
			</p>
			
			<h4>Model</h4>
			
			<table class="model">
				<tr><th>Term</th><th>Type</th><th>Description</th></tr>
				<tr>
					<td>state</td>
					<td>Relationship</td>
					<td>The relationship between the Locator and the <a>State</a>.<br/>There MAY be 0 or more <code>state</code> relationships for each Locator.  Multiple States SHOULD select the same content, however some States will not have the same precision as others. Consuming user agents MUST pick one of the described <a data-lt="segment">segments</a>, if they are different.</td>
				</tr>
			</table>
			
			<p>States MUST be processed before processing <a>Selector</a> information.</p>
			
			<h4>Example</h4>
			
			<pre class="example highlight" title="State">
{
  "source": "http://example.org/page1",
  "state": {
    "id": "http://example.org/state1"
  }
}
			</pre>
			
			<section id="TimeState_def">
				<h3>Time State</h3>
				
				<p>
					A Time State resource records the time at which the resource is when the intended selection occurs, typically the time that the resource was created and/or a link to a persistent copy of the current version. 
					The timestamp for the resource could be resolved via the Memento protocol, described in RFC 7089 [[rfc7089]].
				</p>
				
				<p>
					<b>Example Use Case:</b> Britney makes a note about the current state of the front page of a news website, and flags that the page is likely to change often.  Her client adds in a State with the current time to describe the version of the page.
				</p>
				
				
				<h4>Model</h4>
				
				<table class="model">
					<tr><th>Term</th><th>Type</th><th>Description</th></tr>
					<tr>
						<td>type</td>
						<td>Relationship</td>
						<td>The class of the State.<br/>Time States MUST have exactly 1 <code>type</code> and the value MUST be <code>TimeState</code>.</td>
					</tr>
					<tr>
						<td>sourceDate</td>
						<td>Property</td>
						<td>The timestamp at which the <a>Source</a> resource should be interpreted. <br/>There MAY be 0 or more <code>sourceDate</code> properties per TimeState. If there is more than 1, each gives an alternative timestamp at which the Source may be interpreted. The timestamp MUST be expressed in the <code>xsd:dateTime</code> format, and MUST use the UTC timezone expressed as "Z". If <code>sourceDate</code> is provided, then <code>sourceDateStart</code> and <code>sourceDateEnd</code> MUST NOT be provided.</td>
					</tr>
					<tr>
						<td>sourceDateStart</td>
						<td>Property</td>
						<td>The timestamp that begins the interval over which the <a>Source</a> resource should be interpreted. <br/>There MAY be exactly 1 <code>sourceDateStart</code> property per TimeState. The timestamp MUST be expressed in the <code>xsd:dateTime</code> format, and MUST use the UTC timezone expressed as "Z". If <code>sourceDateStart</code> is provided then <code>sourceDateEnd</code> MUST also be provided.</td>
					</tr>
					<tr>
						<td>sourceDateEnd</td>
						<td>Property</td>
						<td>The timestamp that ends the interval over which the <a>Source</a> resource should be interpreted. <br/>There MAY be exactly 1 <code>sourceDateEnd</code> property per TimeState. The timestamp MUST be expressed in the <code>xsd:dateTime</code> format, and MUST use the UTC timezone expressed as "Z". If <code>sourceDateEnd</code> is provided then <code>sourceDateStart</code> MUST also be provided.</td>
					</tr>
					<tr>
						<td>cached</td>
						<td>Relationship</td>
						<td>A link to a copy of the <a>Source</a> resource's representation, appropriate for the application. <br/>There MAY be 0 or more <code>cached</code> relationships per TimeState. If there is more than 1, each gives an alternative copy of the representation.</td>
					</tr>
				</table>
				
				
				<h4>Example</h4>
				
				<pre class="example highlight" title="Time State" id="TimeState_ex">
{
  "source": "http://example.org/page1",
  "state": {
    "type": "TimeState",
    "cached": "http://archive.example.org/copy1",
    "sourceDate": "2015-07-20T13:30:00Z"
  }
}
				</pre>
			</section>
			
			<section id="HttpRequestState_def">
				<h3>Request Header State</h3>
				
				<p>
					As there are potentially many representations that can be delivered from a resource with a single URL, and a selection may only apply to one of them, it is important to be able to record the HTTP Request headers that need to be sent to retrieve the correct representation.  
					The HttpRequestState resource maintains a copy of the headers to be replayed when obtaining the representation.
				</p>
				
				<p>
					<b>Example Use Case:</b> Carla retrieves a PDF representation of a Web resource that can deliver HTML, PDF or plain text and then writes a description about it. 
					She signals that her description is only about the PDF representation.
					Her client then includes a State to describe how to retrieve the target representation.
				</p>
				
				<h4>Model</h4>
				
				<table class="model">
					<tr><th>Term</th><th>Type</th><th>Description</th></tr>
					<tr>
						<td>type</td>
						<td>Relationship</td>
						<td>The class of the State.<br/>Request Header States MUST have exactly 1 <code>type</code> and the value MUST be <code>HttpRequestState</code>.</td>
					</tr>
					<tr>
						<td>value</td>
						<td>Property</td>
						<td>The HTTP request headers to send as a single, complete string.<br/>An HttpRequestState MUST have exactly 1 <code>value</code> property.</td>
					</tr>
				</table>
				
				<div class="note">
					The representation retrieved from the server by the original annotator's client might not be completely determined by request headers alone.
					For example, the IP address of the client might also determine the language of the representation, based on the language of the country the user was present in at the time.
					If the server returns a <code>Content-Location</code> header, then the client might instead use it as the <code>target</code> of the Annotation, rather than the URL that was requested.
				</div>
				
				<h4>Example</h4>
				
				<pre class="example highlight" title="HTTP Request State" id="HttpRequestState_ex">
{
  "source": "http://example.org/resource1",
  "state": {
    "type": "HttpRequestState",
    "value": "Accept: application/pdf"
  }
}
				</pre>
			</section>
			
			<section id="StateRefinement_def">
				<h3>Refinement of State</h3>
				
				<p>
					Similar to the <a href="#SelectorRefinement_def">refinement of selection</a>, it may be easier, more reliable or more accurate to specify the appropriate state of the resource as a hierarchy of atomic <a>State</a> resources.
					This is particularly appropriate for representing the combination of a <a>State</a> that reflects an internal transformation along with the results of a State that describes an external request.
					This decomposition is accomplished by having the states chained together in the same way as Selectors.
				</p>
				
				<p>
					Further, given that the State(s) will likely result in a specific representation, there may be specific <a data-lt="Selector">Selectors</a> that are appropriate for describing the <a>segment</a> of the representation.
					In order to accommodate this, States may also be refined by <a data-lt="Selector">Selectors</a>.
				</p>
				
				<p>
					<b>Example Use Case:</b> Devina writes a comment about a travel e-book which has many versions available over time, and is available in different formats.
					She is particularly commenting on a specific version and format, so her client adds both a TimeState to capture the time and an HttpRequestState to capture the format.
				</p>
				
				<h4>Model</h4>
				
				<table class="model">
					<tr><th>Term</th><th>Type</th><th>Description</th></tr>
					<tr>
						<td>refinedBy</td>
						<td>Relationship</td>
						<td>The relationship between a broader <a>State</a> and either a more specific <a>State</a> or a <a>Selector</a> that SHOULD be applied to the results of the first.
							<br/>Each State MAY be <code>refinedBy</code> 1 or more other States or Selectors.  If more than 1 is given, then they are considered to be alternatives that will result in the same result.
						</td>
					</tr>
				</table>
				
				<h4>Example</h4>
				
				<pre class="example highlight" title="Refinement of States"  id="StateRefinement_ex">
{
  "source": "http://example.org/ebook1",
  "state": {
    "type": "TimeState",
    "sourceDate": "2016-02-01T12:05:23Z",
    "refinedBy": {
      "type": "HttpRequestState",
      "value": "Accept: application/epub+zip"
    }
  }
}
				</pre>
			</section>
		</section> <!-- /States -->

		<section id="position">
			<h3>Positions</h3>
			
			<p>
				A <dfn data-lt="Positions">Position</dfn> object describes a <a>Locus (of Interest)</a> within a stream 
				representation of a <a>Web Resource</a>. 				
				</p>
			
			<p>A Position specifier requires knowledge of two distinct entities:</p>			
			<ol>
				<li>
					the <a href=" https://w3c.github.io/wpub/index.html#dfn-url">URL</a> of the overall resource; this is the same <a>Source</a> as used for Selectors (see <a href="#selectors"></a>). 
				</li>
				<li>an integer representing the count of bytes or characters in the stream preceding the locus of interest.</li>
			</ol>
			
			<p>
				<b>Example Use Case:</b> Allen, while reading chapter 1 of a digital edition of <em>Moby Dick</em>,
				generates (as a separate resource with its own URL) a Position specifier to note the position in the digital 
				text stream representation where the first page break in chapter 1 of a <em>Moby Dick</em> print edition occurred. 
			</p>
			
			<h4>Model</h4>
			
			<table class="model">
				<tr><th>Term</th><th>Type</th><th>Description</th></tr>
				<tr>
					<td>position</td>
					<td>Relationship</td>
					<td>The relationship between the Locator and a <a>Position</a> specifier.<br/>
						A Locator MAY have 0 or 1 <code>position</code> relationships. </td>
				</tr>
			</table>
			
			<p>
				When processing a <a>Locator</a> that includes <a>Selector</a> and/or <a>State</a> specifier(s) the Position specifier (if present) MUST be processed last.
			</p>
			
			<h4>Example</h4>
			
			<pre class="example highlight" title="Position">
{
  "scope": "https://dauwhe.github.io/html-first/MobyDick.wpub",
  "source": "https://dauwhe.github.io/html-first/MobyDickNav/html/c001.html",
  "position": {
    "id": "http://example.org/printPageBreak-c1.1"
  }
}
			</pre>

			<section id="TextStreamPosition_def">
				<h3>Text Stream Position</h3>
				
				<p>
					The <dfn>TextStreamPosition</dfn> specifier describes an inter-character position in a text stream by recording the 
					number of characters that precede the position. 
					The property <code>value</code> is used to record this character count. 
				  	A <code>value</code> of 0 would describe the position immediately before the first character, a <code>value</code> of 1 would describe the position immediately after the first character and before the second character (i.e., the position between the first two characters of the stream), and so on. 
					For example, if the text stream was “abcdefghijklmnopqrstuvwxyz” and the <code>value</code> was 7, then the position referenced would be the position between "g" and "h". If n is the length of the text stream, then a <code>value</code> equal to n denotes the position immediately	following the last character in the text stream. 
				</p>
				
				<p>
					In some situations, it is important to preserve which side of a position a location reference points to. 
					For example, when resolving a text stream position in a dynamically paginated environment, it could make a difference if a position is attached to the content before or after the location being referenced (e.g., to determine whether to display the verso or recto side at a page break). 
					In a <code>TextStreamPosition</code> object, the <code>bias</code> property MAY be used to attach a position reference to the character preceding the position identified by the <code>value</code> property (<code>"bias": "before"</code>) or to the character following the position (<code>"bias": "after"</code>). 
					For example, if the text stream was “abcdefghijklmnopqrstuvwxyz”, the <code>value</code> was 7, and the <code>bias</code> was <code>before</code>, then the position referenced would be the position between "g" and "h" and would be attached to "g".	
				</p>
				
				<p class="note">
					The property <code>bias</code> is only meaningful when some type of break (e.g., a page break or line break) falls or might fall at the position specified by the TextStreamPosition specifier.
				</p>				
				
				<p>
					<b>Example Use Case:</b> George notices that a letter is missing between characters 322 and 323 in the text of an HTML file he is reading and decides he wants to mark the position of the missing letter by generating a TextStreamPosition specifier so that the letter can be inserted later during editing. 
					He also wants to ensure that if a hyphen and line break should be dynamically inserted in this position the missing character would follow the break, and so he uses the bias property to associate the position reference with the character that follows the position being referenced (i.e., character 323).
				</p>
								
				<p class="ednote">
					Is this a valid example as regards bias? 
					Or is this kind of situation better handled by an application rather than conflating a side-bias property with the position reference.
					If not compelling enough, we need a better more concrete, real-world use case for side-bias!
					Otherwise we should drop side-bias.
				</p>
			
				<p class=issue data-number=9></p>
				
				<h4>Model</h4>
					<table class="model">
						<tr><th>Term</th><th>Type</th><th>Description</th></tr>
						<tr>
							<td>type</td>
							<td>Relationship</td>
							<td>The class of the Position specifier.<br/>
								A Text Stream Position specifier MUST have exactly 1 <code>type</code> and the value MUST be 
								<code>TextStreamPosition</code>.</td>
						</tr>
						<tr>
							<td>value</td>
							<td>Property</td>
							<td>The count of characters in the text stream preceding the <a>Locus (of interest)</a>.
								<br/>Each TextStreamPosition MUST have exactly 1 <code>value</code> property, and it MUST be a non-negative integer
								less than or equal to the number of characters in the text stream.</td>
						</tr>
						<tr>
							<td>bias</td>
							<td>Property</td>
							<td>This property is used to associate a position reference with either the character that 
								preceeds it or follows it. <br/>
								Each TextPositionSelector MAY include 0 or 1 <code>bias</code> properties, and the value 		
								of <code>bias</code> MUST be either <code>before</code> or <code>after</code>.	</td>
						</tr>
					</table>
					
					<p>
						The text MUST be selected and normalized in the same way as for the <a href="#TextQuoteSelector_def">Text Quote Selector</a> before counting the number of characters to determine the <code>value</code> to be used.
					</p>
				
				<h4>Example</h4>
				
				<pre class="example highlight" title="TextStreamPosition" id="TextStreamPosition_ex">
{
  "scope": "https://dauwhe.github.io/html-first/MobyDick.wpub",
  "source": "https://dauwhe.github.io/html-first/MobyDickNav/html/c001.html",
  "position": {
    "type": "TextStreamPosition",
    "value": 322,
    "bias": "after"
  }
}
				</pre>
			</section>
			
			<section id="DataStreamPosition_def">
				<h3>Data Stream Position</h3>
				
				<p>
					Similar to the <a>TextStreamPosition</a> specifier, the <dfn>DataStreamPosition</dfn> specifier describes a position between two bytes in a byte stream representation of a resource by recording the number of bytes that precede the position. 
					The property <code>value</code> is used to record this byte count. 
					A <code>value</code> of 0 would describe the position immediately before the first byte, a <code>value</code> 1 would describe the position immediately after the first byte and before the second byte (i.e., the position between the first two bytes of the stream), and so on. 
					If n is the length of the byte stream, then a <code>value</code> equal to n denotes the position immediately following the last byte in the stream. 
				</p>
								
				<p>
					<b>Example Use Case:</b> Paul's data processing application fails after processing the first 401 bytes of a resource's byte stream representation. 
					Before exiting, the application generates a <code>DataStreamPosition</code> object to record the position where processing was interrupted. 
					This will facilitate resumption of processing after the processing bug is resolved.
				</p>				
				
				<h4>Model</h4>
				
				<table class="model">
					<tr><th>Term</th><th>Type</th><th>Description</th></tr>
					<tr>
						<td>type</td>
						<td>Relationship</td>
						<td>The class of the Position specifier.<br/>
							A Data Stream Position specifier MUST have exactly 1 <code>type</code> and the value MUST be 
							<code>DataStreamPosition</code>.</td>
					</tr>
					<tr>
						<td>value</td>
						<td>Property</td>
						<td>The count of bytes in the byte stream preceding the <a>Locus (of interest)</a>. 							
							<br/>Each DataStreamPosition MUST have exactly 1 <code>value</code> property, and it MUST be a non-negative integer
							less than or equal to the number of bytes in the stream.</td>
					</tr>
				</table>
				
				<h4>Example</h4>
				
				<pre class="example highlight" title="DataStreamPosition" id="DataStreamPosition_ex">
{
  "source": "https://example.org/MyData.json",
  "position": {
    "type": "DataStreamPosition",
    "value": 401
  }
}
				</pre>
			</section>

			<section id="PositionRefinement_def">
				<h3>Using Position to Refine</h3>
				
				<p>
					Unlike <a>Selector</a> and <a>State</a> specifiers, a <a>Position</a> specifier can not be refined (since it identifies a point in a stream rather than a part of a resource or a representation of a resource). 
					However, it may be easier, more reliable, more accurate, or less brittle to resolve a Position specifier in the context of a part of a resource defined by a <a>Selector</a> and/or a representation of a resource described by a <a>State</a>. 
					Thus a Position specifier may be used to refine a Selector or State (including refined Selectors or States), as long as the Position specifier is the final refinement step processed.
				</p>
				<p>
					<b>Example Use Case:</b> Deren is one of several people who are collaboratively editing an HTML file. 
					He needs to generate a TextStreamPosition specifier identifying a position where the word "Mister" needs to be inserted in one of the paragraphs he alone has been assigned to edit. 
					He doesn't want to specify a text character count within the text stream representation of the entire HTML file, since he knows other edits are in progress that could affect that character count. 
					So instead he uses a <a href="#CssSelector_def">CssSelector</a> to select the paragraph of interest and then refines this selection with a <a>TextStreamPosition</a> specifier to reference the position within the paragraph where the insertion is needed.
				</p>
				
				<h4>Example</h4>
				
				<pre class="example highlight" title="Refinement by Position Specifier"  id="PositionRefinement_ex">
{
  "scope": "https://dauwhe.github.io/html-first/MobyDick.wpub",
  "source": "https://dauwhe.github.io/html-first/MobyDickNav/html/c001.html",
  "selector": {
    "type": "CssSelector",
    "value": "p:nth-child(2)",
    "refinedBy": {
      "type": "TextStreamPosition",
      "value": 8
    }		
  }
}
				</pre>
			</section>
		</section> <!-- /Position -->

		<section id="frags">
			<h3>Selectors, Positions, and States as Fragment Identifiers</h3>

			<p>
				Although <a data-lt="Selector">Selectors</a>, <a data-lt="Position">Positions</a>, and <a data-lt="State">States</a> provide a flexible way of identifying, e.g., a suitable <a>Segment</a> of a Resource, the fact that this is defined through an indirection using a <a>Locator</a> may be an obstacle for some applications. 
			</p>

			<p class="ednote">
				We must add a good example. The original one referred to RDF, which is not relevant in this context.
			</p>

			<p>
				To mitigate this issue, a mapping of <a data-lt="Selector">Selectors</a>, <a data-lt="Position">Positions</a>,
				and <a data-lt="State">States</a> on URL fragments&nbsp;[[url]] is defined below. 
				As a result of this mapping the selected <a>Segment</a>, targeted <a>Locus</a>, or relevant <a>State</a> is expressed in a 
				single (albeit complex) URL.
				In that URL the <a>Selector</a>, <a>Position</a>, or <a>State</a> is expressed as a 
				single string and serves 
				as a fragment which can be combined with the URL of the <a>Source</a>. 
				Note that this representation is valid only if the URL for the <a>Source</a> does not contain a fragment 
				identifier of its own (a URL may contain at most one fragment identification).
			</p>

			<p>
				The syntax for mapping a <a>Selector</a>, <a>Position</a>, or <a>State</a> follows the same, “functional” syntax as used, 
				for example, by the XPointer Framework&nbsp;[[xptr-framework]]:
			</p>

			<ul>
				<li>The fragment uses the <code>selector(…)</code>, <code>position(...)</code>, or <code>state(…)</code> functional syntax.</li>
				<li>The (comma separated) “parameters” of the functional notation are:
					<ul>
						<li>For the keys <code>startSelector</code> and <code>endSelector</code> the syntax is <code>key=selector(…)</code>,
							  with the value following, recursively, the same syntax as a full <code>selector(...)</code> fragment;</li>
						<li>For the key <code>refinedBy</code> the syntax is <code>refinedBy=selector(…)</code>, 
							<code>refinedBy=position(...)</code>, or <code>refinedBy=state(...)</code>,
							  with the value following, recursively, the same syntax as a full fragment;</li>
						<li>For the key <code>selectors</code> the syntax is <code>selectors(…)</code> containing a comma separated list of selectors;</li>
						<li>For the key <code>scope</code>, <code>scope=url</code> is added to the top level <code>selector(…)</code>, <code>position(…)</code>, or <code>state(…)</code>, although, strictly speaking, the scope value is set on the overall Locator rather than one of the <a>Specifiers</a>.</li>
						<li>otherwise the key, and the corresponding value, follows the simple <code>key=value</code> syntax, e.g., <code>type=CssSelector</code>.</li>
					</ul>
				</li>
			</ul>

			<p>(see the examples below.)</p>

			<p class=issue data-number21>Alternative: <code>scope</code> should appear as part of the fragment, alongside the top level <code>selector(…)</code>, and not part of it.</p>

			<p>The values SHOULD be percent encoded&nbsp;[[rfc3986]]; the encoding is a MUST for characters that may make the fragment ambiguous, namely:</p>

			<!-- should be <table class="data"> but the stylesheet has issues.... -->
			<table >
				<thead>
					<tr>
						<td><strong>character</strong></td>
						<td><strong>code</strong></td>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>space</td>
						<td>%20</td>
					</tr>
					<tr>
						<td><code>=</code></td>
						<td>%3D</td>
					</tr>
					<tr>
						<td><code>,</code></td>
						<td>%2C</td>
					</tr>
					<tr>
						<td><code>#</code></td>
						<td>%23</td>
					</tr>
				</tbody>
			</table>

			<div class="note">
				<p>
					A fragment identifier is defined for a specific media type. This means that, formally, the fragment identifier syntax and semantics defined in this section should be registered for each media type separately by <a href="http://www.iana.org/assignments/media-types/media-types.xhtml">IANA</a>.
					Until such a registration is done, these fragment identifiers have the potential to conflict with other fragments possibly specified by the media type registrations.
					Consequently, this pattern should only be used when the implementation cannot produce or manage the full representation described above. 
				</p>
			</div>

			<section>
				<h4>JSON examples converted to fragment identifiers</h4>

				<p>
					This section contains a mapping of all examples used in the definition of <a data-lt="Selector">Selectors</a> and <a data-lt="State">States</a> onto full URL-s with fragment identifiers.
					Note that the examples below have been broken into several lines for a greater readability; in real usage such new lines are not allowed in a URL.
				</p>

				<!-- <p class="note">
					A <a href="http://w3c.github.io/web-annotation/selector-note/converter/">simple converter tool</a> is also available to test the conversion of the JSON format to fragment and back.
				</p> -->

				<p class="ex_title"><a href="#FragmentSelector_ex">Example</a> for a <a href="#FragmentSelector_def"></a></p>
				<pre class="example nohighlight" title="Fragment Selector as Fragment" id="FragmentSelector_frag">
				http://example.org/video1#selector(
				  type=FragmentSelector,
				  conformsTo=http://www.w3.org/TR/media-frags,
				  value=t%3D30%2C60
				)
				</pre>

				<p class="ex_title"><a href="#CssSelector_ex">Example</a> for a <a href="#CssSelector_def"></a></p>
				<pre class="example nohighlight" title="CSS Selector as Fragment" id="CssSelector_frag">
				https://dauwhe.github.io/html-first/MobyDickNav/html/c001.html#selector(
				  type=CssSelector,
				  scope=https://dauwhe.github.io/html-first/MobyDick.wpub,
				  value=%23elemid%20>%20.elemclass%20+%20p
				)				 
				</pre>

				<p class="ex_title"><a href="#XPathSelector_ex">Example</a> for a <a href="#XPathSelector_def"></a></p>
				<pre class="example nohighlight" title="XPath Selector as Fragment" id="XPathSelector_frag">
				http://example.org/page1.html#selector(
				  type=XPathSelector,
				  value=/html/body/p[2]/table/tr[2]/td[3]/span
				)
				</pre>

				<p class="ex_title"><a href="#TextQuoteSelector_ex">Example</a> for a <a href="#TextQuoteSelector_def"></a></p>
				<pre class="example nohighlight" title="Text Quote Selector as Fragment" id="TextQuoteSelector_frag">
				http://example.org/page1#selector(
				  type=TextQuoteSelector,
				  exact=annotation,
				  prefix=this%20is%20an%20,
				  suffix=%20that%20has%20some
				)
				</pre>

				<p class="ex_title"><a href="#TextPositionSelector_ex">Example</a> for a <a href="#TextPositionSelector_def"></a></p>
				<pre class="example nohighlight" title="Text Position Selector as Fragment" id="TextPositionSelector_frag">
				http://example.org/ebook1#selector(
				  type=TextPositionSelector,
				  start=412,
				  end=795
				)
				</pre>

				<p class="ex_title"><a href="#DataPositionSelector_ex">Example</a> for a <a href="#DataPositionSelector_def"></a></p>
				<pre class="example nohighlight" title="Data Position Selector as Fragment" id="DataPositionSelector_frag">
				http://example.org/diskimg1#selector(
				  type=DataPositionSelector,
				  start=4096,
				  end=4104
				)
				</pre>

				<p class="ex_title">First <a href="#SvgSelector_ex_1">example</a> for a <a href="#SvgSelector_def"></a></p>
				<pre class="example nohighlight" title="SVG Selector as Fragment, referring to an external SVG" id="SvgSelector_frag_1">
				http://example.org/map1#selector(
				  type=SvgSelector,
				  id=http://example.org/svg1
				)
				</pre>

				<p class="ex_title">Second <a href="#SvgSelector_ex_2">example</a> for a <a href="#SvgSelector_def"></a></p>
				<pre class="example nohighlight" title="SVG Selector as Fragment, using embedded SVG" id="SvgSelector_frag_2">
				http://example.org/map1#selector(
				  type=SvgSelector,
				  value=&lt;svg:svg&gt;%20…%20&lt;/svg:svg&gt;
				)
				</pre>

				<p class=note>
					Please note that long SVG representations will produce very long URLs when produced according to this pattern.
					Care should be taken in environments where there is a character limit to URLs, and implementers should consider publishing the SVG as a separate resource and using its URL as shown in <a href="#SvgSelector_frag_1">Example 22</a>.
				</p>

				<p class="ex_title"><a href="#EmbeddedResourceSelector_ex">Example</a> for an <a href="#EmbeddedesourceSelector_def"></a></p>
				<pre class="example nohighlight" title="Embedded Resource Selector as Fragment" id="EmbeddedResourceSelector_frag">
				https://dauwhe.github.io/html-first/MobyDick.wpub#selector(
				  type=EmbeddedResourceSelector,
				  value=https://dauwhe.github.io/html-first/MobyDickNav/images/moby-dick-book-cover.jpg
				)
				</pre>

				<p class="ex_title"><a href="#SelectorRefinement_ex">Example</a> for a <a href="#SelectorRefinement_def"></a></p>
				<pre class="example nohighlight" title="Selector Refinement as Fragment" id="SelectorRefinement_frag">
				http://example.org/page1#selector(
				  type=FragmentSelector,
				  value=para5,
				  refinedBy=selector(
				    type=TextQuoteSelector,exact=Selected%20Text,
				    prefix=text%20before%20the%20,
				    suffix=%20and%20text%20after%20it
				  )
				)
				</pre>

				<p class="ex_title"><a href="#RangeSelector_ex">Example</a> for a <a href="#RangeSelector_def"></a></p>
				<pre class="example nohighlight" title="Range Selector as Fragment" id="RangeSelector_frag">
				https://dauwhe.github.io/html-first/MobyDickNav/html/c001.html#selector(
				  type=RangeSelector,
				  startSelector=selector(
				    type=TextQuoteSelector,
				    exact=Call%20me%20Ishmael.,
				    suffix=Some%20years%20ago
				  ),
				  startSelector=selector(
				    type=TextQuoteSelector,
				      exact=He%20desires%20to%20paint%20you%20the%20dreamiest,%20, 
				      prefix=But%20here%20is%20an%20artist.%20, 
				      suffix=shadiest%2C%20quietest
				  )
				)
				</pre>

				<p class="ex_title"><a href="#RangeSelector_ex_1">Example</a> for a <a href="#RangeSelector_def"></a> Over Several Resources</p>
				<pre class="example nohighlight" title="Range Selector Over Several Resourcest" id="RangeSelector_frag_1">
				https://dauwhe.github.io/html-first/MobyDick.wpub#selector(
				  type=RangeSelector,
				  startSelector=selector(
				    type=EmbeddedResourceSelector,
				    value=https://dauwhe.github.io/html-first/MobyDickNav/html/c001.html,
				    refinedBy=selector(
				      type=TextQuoteSelector,
				      exact=Call%20me%20Ishmael.,
				      suffix=Some%20years%20ago
				    )
				  ),
				  selectors(
				    selector(
				      type=EmbeddedResourceSelector,
				      value=https://dauwhe.github.io/html-first/MobyDickNav/html/c002.html						
				    ),
				    selector(
				      type=EmbeddedResourceSelector,
				      value=https://dauwhe.github.io/html-first/MobyDickNav/html/c003.html						
				    )	
				  ),
				  endSelector=selector(
				    type=EmbeddedResourceSelector,
				    value=https://dauwhe.github.io/html-first/MobyDickNav/html/c003.html,
				    refinedBy=selector(
				      type=TextQuoteSelector,
				      exact=He%20commenced%20dressing,
				      suffix=%20at%top
				    )
				  )
				)
				</pre>

				<p class="ex_title"><a href="#MultiSelector_ex">Example</a> for a <a href="#MultiSelector_def"></a></p>
				<pre class="example nohighlight" title="Multi Selector as Fragment" id="MultiSelector_frag">
				https://textbook.example.org#selector(
				  type=MultiSelector,
				  selectors(
				    selector(
				      type=EmbeddedResourceSelector,
				      value=https://textbook.example.org/section2.html,
				      refinedBy=selector(
				        type=CssSelector,
				        value=body>section:nth-of-type(3)
				      )
				    ),
				    selector(
				      type=EmbeddedResourceSelector,
				      value=https://textbook.example.org/section4.html
				      refinedBy=selector(
				        type=CssSelector,
				        value=body>section:nth-of-type(6)
				      )
				    ),
				    selector(
				      type=EmbeddedResourceSelector,
				      value=https://textbook.example.org/section7.html
				      refinedBy=selector(
				        type=CssSelector,
				        value=body>section:nth-of-type(8)
				      )
				    )
				  )
				)
				</pre>

				<p class="ex_title"><a href="#TimeState_ex">Example</a> for a <a href="#TimeState_def"></a></p>
				<pre class="example nohighlight" title="Time State as Fragment" id="TimeState_frag">
				http://example.org/page1#state(
				  type=TimeState,
				  cached=http://archive.example.org/copy1,
				  sourceDate=2015-07-20T13:30:00Z
				)
				</pre>

				<p class="ex_title"><a href="#HttpRequestState_ex">Example</a> for a <a href="#HttpRequestState_def"></a></p>
				<pre class="example nohighlight" title="HTTP Request State as Fragment" id="HttpRequestState_frag">
				http://example.org/resource1#state(
				  type=HttpRequestState,
				  value=Accept:%20application/pdf
				)
				</pre>

				<p class="ex_title"><a href="#StateRefinement_def">Example</a> for a <a href="#StateRefinement_def"></a></p>
				<pre class="example nohighlight" title="Refinement of States as Fragment" id="StateRefinement_frag">
				http://example.org/ebook1#state(
				  type=TimeState,sourceDate=2016-02-01T12:05:23Z,
				  refinedBy=state(
				    type=HttpRequestState,
				    value=Accept:%20application/epub+zip
				  )
				)
				</pre>
				
				<p class="ex_title">Example for a <a href="#TextStreamPosition_def"></a></p>
				<pre class="example nohighlight" title="Text Stream Position as Fragment" id="TextStreamPosition_frag">
				https://dauwhe.github.io/html-first/MobyDickNav/html/c001.html#position(
				  type=TextStreamPosition,
				  value=322,
				  bias=after
				)
				</pre>				

				<p class="ex_title">Example for a <a href="#DataStreamPosition_def"></a></p>
				<pre class="example nohighlight" title="Data Stream Position as Fragment" id="DataStreamPosition_frag">
				https://example.org/MyData.json#position(
				  type=DataStreamPosition,
				  value=401
				)
				</pre>	
				
				<p class="ex_title">Example for a <a href="#PositionRefinement_def"></a></p>
				<pre class="example nohighlight" title="Text Stream Position Refinement of CssSelector as Fragment" id="PositionRefinement_frag">
				https://example.org/MyData.json#selector(
				  type=CssSelector,
				  value=p:nth-child(2),
				  refinedBy=position(
				    type=TextStreamPosition,
				    value=8	
				  )
				)
				</pre>	
			</section>

			<!-- <section>
				<h4>Serializing IRI to URL</h4>

				<p>Care should be taken that to make use of a Selectors and States IRIs as URLs (i.e., not only as identifiers but as locators), each segment of the URL must be mapped to a corresponding URL segment following [[rfc3987]]. Applying percent encoding method for entire URL string might also cause unnecessary troubles. Some examples:</p>

				<pre class="example nohighlight" title="Text Quote Selector in Japanese as a URL and a URL, respectively">
					http://jp.example.org/page1
						#selector(type=TextQuoteSelector,
							exact=ペンを,
							prefix=私は、,
							suffix=持っています)

					http://jp.example.org/page1
						#selector(type=TextQuoteSelector,
							exact=%E3%83%9A%E3%83%B3%E3%82%92,
							prefix=%E7%A7%81%E3%81%AF%E3%80%81,
							suffix=%E6%8C%81%E3%81%A3%E3%81%A6%E3%81%84%E3%81%BE%E3%81%99)
				</pre>

				<pre class="example nohighlight" title="Percent Encoded Text Quote Selector as a URL and a URL, respectively">
					http://example.org/page1
						#selector(type=TextQuoteSelector,exact=annotation,
							prefix=this%20is%20an%20,suffix=%20that%20has%20some)

					http://example.org/page1
						#selector(type=TextQuoteSelector,exact=annotation,
							prefix=this%2520is%2520an%2520,suffix=%2520that%2520has%2520some)
				</pre>

				<p>Note that the URL may also contain an internationalized domain name, which must be encoded as well (see [[rfc3490]]).</p>

			</section> -->
		</section>

		<section id="media_selector">
			<h2>Correspondence Among Media Types and Selectors</h2>
	
			<p>
				Not all <a href="#selectors">Selectors</a> are relevant for all media types; some combinations are meaningless or not formally defined. 
				An implementation may therefore ignore certain types of Selectors in case the corresponding media types are not handled by that particular implementation.
			</p>
	
			<p>
				The table below shows the correspondence among the main media types addressed in this specification and <a>Selector</a> types.
				The meaning of the table elements, and their effect on implementation conformance, is as follows.
			</p>

			<ul>
				<li>
					A “✔︎” sign in the table means that the Selector type is relevant for that particular media types. 
					A conforming implementation MUST implement that particular combination <em>if</em> it handles the corresponding media type.
				</li>

				<li>
					A “✘” sign in the table means that the Selector type is not relevant for that particular media types.
					Conforming implementations SHOULD ignore that particular combination.
				</li>

				<li>
					A “?” means that it is not possible to specify, in general, whether that particular combination is meaningful (e.g., fragment identifiers are defined for specific media types, i.e., specific text media types other than plain text may have fragments defined but they are not listed in the table).
					In other cases the usefulness of such combination is not clear (e.g., Data Position selectors for binary images).
					Conforming implementations MAY implement that particular combination.
				</li>
			</ul>
		
			<table id="media_table" class="model">
				<thead>
					<tr>
						<td> </td>
						<th>Fragment</th>
						<th>CSS</th>
						<th>XPath</th>
						<th>Text Quote</th>
						<th>Text Position</th>
						<th>Data Position</th>
						<th>Svg</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<th>HTML (text/html)</th>
						<td>✔︎</td>
						<td>✔︎</td>
						<td>✔︎</td>
						<td>✔︎</td>
						<td>✔︎</td>
						<td>✘</td>
						<td>✘</td>
					</tr>
					<tr>
						<th>CSV (text/csv)</th>
						<td>✔︎</td>
						<td>✘</td>
						<td>✘</td>
						<td>✔︎</td>
						<td>✔︎</td>
						<td>✘</td>
						<td>✘</td>
					</tr>
					<tr>
						<th>Plain Text (text/plain)</th>
						<td>✔︎</td>
						<td>✘</td>
						<td>✘</td>
						<td>✔︎</td>
						<td>✔︎</td>
						<td>✘</td>
						<td>✘</td>
					</tr>
					<tr>
						<th>Other text files (text/*) </th>
						<td>?</td>
						<td>✘</td>
						<td>✘</td>
						<td>✔︎</td>
						<td>✔︎</td>
						<td>✘</td>
						<td>✘</td>
					</tr>
					<tr>
						<th>PDF (application/pdf) </th>
						<td>✔︎</td>
						<td>✘</td>
						<td>✘</td>
						<td>✔︎</td>
						<td>✔︎</td>
						<td>✘</td>
						<td>✘</td>
					</tr>
					<tr>
						<th>XML (application/xml, application/*+xml) </th>
						<td>✔︎</td>
						<td>✔︎</td>
						<td>✔︎</td>
						<td>✔︎</td>
						<td>✔︎</td>
						<td>✘</td>
						<td>✘</td>
					</tr>
					<tr>
						<th>SVG (image/svg+xml)</th>
						<td>✔︎</td>
						<td>✔︎</td>
						<td>✔︎</td>
						<td>✔︎</td>
						<td>✔︎</td>
						<td>✘</td>
						<td>✔︎</td>
					</tr>
					<tr>
						<th>Image, other than SVG (image/gif, image/jpeg, image/png,
						image/tiff)</th>
						<td>✔︎</td>
						<td>✘</td>
						<td>✘</td>
						<td>✘</td>
						<td>✘</td>
						<td>?</td>
						<td>✔︎</td>
					</tr>
					<tr>
						<th>Video (video/*)</th>
						<td>✔︎</td>
						<td>✘</td>
						<td>✘</td>
						<td>✘</td>
						<td>✘</td>
						<td>?</td>
						<td>✔︎</td>
					</tr>
					<tr>
						<th>Binary Data Files</th>
						<td>?</td>
						<td>✘</td>
						<td>✘</td>
						<td>✘</td>
						<td>✘</td>
						<td>✔︎</td>
						<td>✘</td>
					</tr>
				</tbody>
			</table>

			<section class="informative">
				<h2>Additional Media Types/Selector Combination</h2>
		
				<p>
					The table below contains some other, possible combinations of media types and selector types, which MAY be implemented but are not mandated by this specification. 
					Some of these combinations may also form the basis for defining new, implementation-specific selector extensions.
				</p>
		
				<table class="model">
					<caption>Additional relationships among other media types and selector types</caption>
					<thead>
						<tr>
							<td> </td>
							<th>Fragment</th>
							<th>CSS</th>
							<th>XPath</th>
							<th>Text Quote</th>
							<th>Text Position</th>
							<th>Data Position</th>
							<th>Svg</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<th>CSS (text/css)</th>
							<td>✘</td>
							<td>✘</td>
							<td>✘</td>
							<td>✔︎</td>
							<td>✔︎</td>
							<td>✘</td>
							<td>✘</td>
						</tr>
						<tr>
							<th>TSV (text/tab-separated-values)</th>
							<td>✔︎<sup>✝</sup></td>
							<td>✘</td>
							<td>✘</td>
							<td>✔︎</td>
							<td>✔︎</td>
							<td>✘</td>
							<td>✘</td>
						</tr>
						<tr>
							<th>JSON (application/json, application/*+json)</th>
							<td>✘</td>
							<td>✘</td>
							<td>✘</td>
							<td>✔︎</td>
							<td>?</td>
							<td>✘</td>
							<td>✘</td>
						</tr>
						<tr>
							<th>Programming languages (application/javascript, python files, etc.)</th>
							<td>✘</td>
							<td>✘</td>
							<td>✘</td>
							<td>✔︎</td>
							<td>?</td>
							<td>✘</td>
							<td>✘</td>
						</tr>
					</tbody>
					<tfoot>
						<tr>
							<td colspan="8" style="font-size:70%">
								<sup>✝</sup>Fragments are not formally defined through IETF, though there are well-known connections to existing fragments or practices.
							</td>
						</tr>
					</tfoot>
				</table>
			</section>
		</section>

		<section class=appendix id=changes>
			<h3>Changes from Previous Versions</h3>

			<section id="changes_from_wa">
				<h4>Changes from the “Selectors and States” Note</h4>

				<p>
					This document has been derived from the “Selectors and States”&nbsp;[[selectors-states]] Working Group Note, published by the Web Annotation Working Group. 
					That Note is based on the formal specification and the semantics of a separate W3C Recommendation, namely the Web Annotation Data Model&nbsp;[[annotation-model]], where it is used to select targets of annotations. 
					This documents introduces some changes as follows. 
				</p>

				<p><strong>Editorial Changes</strong></p>
				<ul>
					<li>
						All references to RDF and JSON-LD have been removed.
					</li>
					<li>
						The reference to EPUBCFI in the definition for <a href="#FragmentSelector_def">Fragment Selectors</a> have been removed.
					</li>
					<li>
						References to <a href="https://www.w3.org/TR/selectors-states/#dfn-class" class="externalDFN">Classes</a> (which, semantically, refer to RDF Classes) have been removed.
					</li>
					<li>
						The term <a href="https://www.w3.org/TR/selectors-states/#specific-resources" class="externalDFN">“Specific Resource”</a> has been changed to <a>Locator</a>. (This is just an alias to “Specific Resource”, hence does not change the original semantics.)
					</li>
					<li>
						Some of the examples have been changed.
					</li>
				</ul>

				<p><strong>Non-editorial Changes</strong></p>
				<ul>
					<li>
						The <a href="#locators"><code>scope</code> relationship</a> has been re-introduced. (This relationship is part of the “Web Annotation Data Model”&nbsp;[[annotation-model]] but was not retained in the “Selectors and States”&nbsp;[[selectors-states]] Note.)
					</li>

					<li>
						Two new Selectors have been added, namely
						<ul>
							<li><a href="#EmbeddedResourceSelector_def">Embedded Resource Selectors</a> can be used to select a full resource, with its a, from a collection of resources, also identified with a URL;</li>
							<li><a href="#MultipleSelector_def">Multiple Selectors</a> identify a collection of discrete selections, whether within the same or spread over several Sources.</li>
						</ul>
					</li>

					<li>
						The <a href="#RangeSelector_def">Range Selector</a> has been extended by:

						<ul>
							<li>making explicit that the start and end selectors may refer to different resources;</li>
							<li>adding a property to define a list of “intermediate” resources for ranges that spread over several of those.</li>
						</ul>
					</li>
					
					<li>A new kind of specifier, the <a>Position</a> specifier, has been added. Two Position specifier types have been added: 
						<ul>
							<li><a href="#TextStreamPosition_def">Text Stream Position</a> can be used to define a position within a text stream representation of a resource.</li>
							<li><a href="#ByteStreamPosition_def">Byte Stream Position</a> can be used to define a position within a byte stream representation of a resource.</li>
						</ul>					
					</li>
				</ul>
			</section>
		</section>
		
		<section class="appendix">
			<h3>Index of JSON Terms</h3>
	
			<table class="model">
				<tr><th>Term</th><th>Usage</th></tr>
				<tr><td>bias</td><td><a href="#TextStreamPosition_def">Text Stream Position</a></td></tr>
				<tr><td>cached</td><td><a href="#TimeState_def">Time State</a></td></tr>
				<tr><td>conformsTo</td><td><a href="#FragmentSelector_def">Fragment Selector</a></td></tr>
				<tr><td>end</td><td><a href="#TextPositionSelector_def">Text Position Selector</a>, <a href="#DataPositionSelector_def">Data Position Selector</a></td></tr>
				<tr><td>endSelector</td><td><a href="#RangeSelector_def">Range Selector</a></td></tr>
				<tr><td>exact</td><td><a href="#TextQuoteSelector_def">Text Quote Selector</a></td></tr>
				<tr><td>position</td><td><a>Locator</a></td></tr>
				<tr><td>prefix</td><td><a href="#TextQuoteSelector_def">Text Quote Selector</a></td></tr>
				<tr><td>refinedBy</td><td><a href="#PositionRefinement_def">Position</a>, <a href="#SelectorRefinement_def">Selector</a>, <a href="#StateRefinement_def">State</a></td></tr>
				<tr><td>selector</td><td><a>Locator</a></td></tr>
				<tr><td>selectors</td><td><a href="#MultiSelector_def">Multi Selector</a>, <a href="#RangeSelector_def">Range Selector</a></td></tr>	<tr><td>scope</td><td><a>Locator</a></td></tr>
				<tr><td>source</td><td><a>Locator</a></td></tr>				
				<tr><td>sourceDate</td><td><a href="#TimeState_def">Time State</a></td></tr>
				<tr><td>sourceDateEnd</td><td><a href="#TimeState_def">Time State</a></td></tr>
				<tr><td>sourceDateStart</td><td><a href="#TimeState_def">Time State</a></td></tr>
				<tr><td>start</td><td><a href="#TextPositionSelector_def">Text Position Selector</a>, <a href="#DataPositionSelector_def">Data Position Selector</a></td></tr>
				<tr><td>startSelector</td><td><a href="#RangeSelector_def">Range Selector</a></td></tr>
				<tr><td>state</td><td><a href="#states">Locator</a></td></tr>
				<tr><td>suffix</td><td><a href="#TextQuoteSelector_def">Text Quote Selector</a></td></tr>
				<tr><td class="top_cell">type</td><td><a>Locator</a>, <a href="#FragmentSelector_def">Fragment Selector</a>, <a href="#CssSelector_def">CSS Selector</a>, <a href="#XPathSelector_def">XPath Selector</a>, <a href="#TextQuoteSelector_def">Text Quote Selector</a>, <a href="#TextPositionSelector_def">Text Position Selector</a>, <a href="#DataPositionSelector_def">Data Position Selector</a>, <a href="#SvgSelector_def">SVG Selector</a>, <a href="#EmbeddedResourceSelector_def">Embedded Resource Selector</a>, <a href="#MultipleSelector_def">Multiple Selector</a>, <a href="#TimeState_def">Time State</a>, <a href="#HttpRequestState_def">Request Header State</a>, <a href="#TextStreamPosition_def">Text Stream Position</a>, <a href="#DataStreamPosition_def">Data Stream Position</a></tr>
				<tr><td>value</td><td><a href="#FragmentSelector_def">Fragment Selector</a>, <a href="#CssSelector_def">CSS Selector</a>, <a href="#SvgSelector_def">SVG Selector</a>, <a href="#XPathSelector_def">XPath Selector</a>, <a href="#EmbeddedResourceSelector_def">Embedded Resource Selector</a>, <a href="#HttpRequestState_def">Request Header State</a>, <a href="#TextStreamPosition_def">Text Stream Position</a>, <a href="#DataStreamPosition_def">Data Stream Position</a> </td></tr>
			</table>
		</section>

		<section>
			<h3>Relationships to the Web Annotation Model</h3>

			<p class="ednote">This is just a placeholder for now; once the specification is, overall, complete, a section should come to summarize the exact relationships to the Web Annotation Model, the relationships in the conformance of the two standards, etc.</p>
		</section>

		<section class=appendix id="issue-summary"></section>
		
		<section id="ack" data-include="https://w3c.github.io/wpub/common/html/acknowledgements.html" data-include-replace="true"></section>
	</body>
</html>
